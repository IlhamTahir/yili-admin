import{P as T,u as L}from"./index.c88cb4e4.js";import{u as H,a as J}from"./useEditDialog.d46c8dd9.js";import{h as M,u as z,f as k,e as w,K as Q,c as v,w as t,l as e,r as s,o as d,a as n,s as N,i as W,j as R,F as A,k as F,L as O,m as B,t as I,I as j,v as X,N as Y}from"./vendor.db0a3e2e.js";import"./useI18n.d1638193.js";const Z=M({__name:"edit-dialog",props:{show:{type:Boolean,default:!1},data:null},emits:["close","confirm"],setup(q,{emit:p}){const _=q,{t:u}=z(),C=k(()=>({username:[{required:!0,message:u("user.management.dialog.username.required"),trigger:"blur"}],nickname:[{required:!0,message:u("user.management.dialog.nickname.required"),trigger:"blur"}],password:[{required:!0,message:u("user.management.dialog.password.required"),trigger:"blur"}],confirmPassword:[{validator:()=>Boolean(f.value),message:u("user.management.dialog.confirmPassword.required"),trigger:"blur"},{validator:$,message:u("user.management.dialog.confirmPassword.validate"),trigger:"blur"}]})),h=k(()=>[{label:"\u7BA1\u7406\u5458",value:"ROLE_ADMIN"},{label:"\u666E\u901A\u7528\u6237",value:"ROLE_USER"}]),b={id:"",username:"",nickname:"",password:"",roles:[]},a=w(_.data||b),g=w(a.value.roles?a.value.roles.map(l=>l.name):[]);Q(_,l=>{a.value=l.data||b,g.value=a.value.roles?a.value.roles.map(o=>o.name):[]});const V=k(()=>_.show),f=w(""),$=()=>a.value.password===f.value,y=w(null),E=()=>{p("confirm",{...a.value,roles:g.value})};return(l,o)=>{const m=s("t-input"),i=s("t-form-item"),P=s("t-select"),D=s("t-form"),U=s("t-dialog");return d(),v(U,{ref:"dialog",width:"900px",visible:e(V),header:a.value.id?l.$t("user.management.dialog.editTitle"):l.$t("user.management.dialog.createTitle"),onClose:o[5]||(o[5]=r=>l.$emit("close")),onConfirm:E},{default:t(()=>[n(D,{ref_key:"form",ref:y,class:"dialog-form",data:a.value,rules:e(C)},{default:t(()=>[n(i,{label:l.$t("user.management.dialog.username.label"),name:"username"},{default:t(()=>[n(m,{placeholder:l.$t("user.management.dialog.username.placeholder"),modelValue:a.value.username,"onUpdate:modelValue":o[0]||(o[0]=r=>a.value.username=r),autocomplete:"off"},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),n(i,{label:l.$t("user.management.dialog.nickname.label"),name:"nickname"},{default:t(()=>[n(m,{placeholder:l.$t("user.management.dialog.username.placeholder"),modelValue:a.value.nickname,"onUpdate:modelValue":o[1]||(o[1]=r=>a.value.nickname=r)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),a.value.id?N("",!0):(d(),v(i,{key:0,label:l.$t("user.management.dialog.password.label"),name:"password"},{default:t(()=>[n(m,{type:"password",placeholder:l.$t("user.management.dialog.password.placeholder"),modelValue:a.value.password,"onUpdate:modelValue":o[2]||(o[2]=r=>a.value.password=r),autocomplete:"off"},null,8,["placeholder","modelValue"])]),_:1},8,["label"])),a.value.id?N("",!0):(d(),v(i,{key:1,label:l.$t("user.management.dialog.confirmPassword.label"),name:"confirmPassword"},{default:t(()=>[n(m,{type:"password",placeholder:l.$t("user.management.dialog.confirmPassword.placeholder"),modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=r=>f.value=r)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])),n(i,{label:l.$t("user.management.dialog.roles.label"),name:"roles"},{default:t(()=>[n(P,{modelValue:g.value,"onUpdate:modelValue":o[4]||(o[4]=r=>g.value=r),options:e(h),placeholder:l.$t("user.management.dialog.roles.placeholder"),clearable:"",multiple:""},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["data","rules"])]),_:1},8,["visible","header"])}}}),x={class:"action-area"},ee={class:"search-area"},te=M({__name:"index",setup(q){const{t:p}=z(),_=k(()=>[{colKey:"id",title:"ID"},{colKey:"username",title:p("user.management.table.username")},{colKey:"nickname",title:p("user.management.table.nickname")},{colKey:"roles",title:p("user.management.table.roles")},{colKey:"operation",title:p("table.operation")}]),u=W({username:""}),{data:C,fetchData:h,pagination:b,loading:a,onPageChange:g}=H(L,u),{showDialog:V,editData:f,handleCreate:$,handleEdit:y,onDialogClose:E,handleConfirm:l}=J(L);return(o,m)=>{const i=s("t-button"),P=s("t-input"),D=s("t-tag"),U=s("t-table"),r=s("t-card"),K=Y("permission");return d(),R(A,null,[n(r,null,{default:t(()=>[F("div",x,[O((d(),v(i,{onClick:e($)},{default:t(()=>[B(I(o.$t("user.management.createBtn")),1)]),_:1},8,["onClick"])),[[K,e(T).USER_LIST_CREATE]])]),F("div",ee,[n(P,{class:"search-input",modelValue:u.username,"onUpdate:modelValue":m[0]||(m[0]=c=>u.username=c),placeholder:o.$t("user.management.search.username.placeholder")},null,8,["modelValue","placeholder"]),n(i,{onClick:e(h)},{icon:t(()=>[n(e(j),{name:"search"})]),_:1},8,["onClick"])]),n(U,{loading:e(a),"row-key":"index",columns:e(_),data:e(C),pagination:e(b),onPageChange:e(g)},{operation:t(c=>[O((d(),v(i,{variant:"text",theme:"primary",onClick:S=>e(y)(c)},{default:t(()=>[n(e(j),{name:"edit"}),B(" "+I(o.$t("edit")),1)]),_:2},1032,["onClick"])),[[K,e(T).USER_LIST_EDIT]])]),roles:t(c=>[(d(!0),R(A,null,X(c.row.roles,(S,G)=>(d(),v(D,{key:G,theme:"primary",variant:"light",style:{"margin-right":"8px",cursor:"pointer"}},{default:t(()=>[B(I(S.label),1)]),_:2},1024))),128))]),_:1},8,["loading","columns","data","pagination","onPageChange"])]),_:1}),n(Z,{show:e(V),data:e(f),onClose:e(E),onConfirm:m[1]||(m[1]=c=>e(l)(c,e(h)))},null,8,["show","data","onClose"])],64)}}});export{te as default};
